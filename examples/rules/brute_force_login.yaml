id: auth-001-brute-force
name: Failed Login Brute Force Attempt
description: |
  Detects multiple failed login attempts from the same source IP address within a short time window.
  This pattern may indicate an automated brute force attack attempting to guess user credentials.
author: Mantissa Log Team
version: 1.0.0
created: 2025-01-27
modified: 2025-01-27

severity: high

enabled: true

query:
  type: sql
  sql: |
    SELECT
      source_ip,
      user,
      COUNT(*) as attempt_count,
      MIN(timestamp) as first_attempt,
      MAX(timestamp) as last_attempt
    FROM normalized_auth_events
    WHERE
      timestamp >= TIMESTAMP '${time_window_start}'
      AND timestamp < TIMESTAMP '${time_window_end}'
      AND result = 'failure'
      AND action IN ('ConsoleLogin', 'AssumeRole', 'GetSessionToken')
    GROUP BY source_ip, user
    HAVING COUNT(*) >= ${parameters.threshold}
    ORDER BY attempt_count DESC
  parameters:
    threshold: 10
    time_window_hours: 1

schedule:
  interval: 5m

threshold:
  field: count
  operator: ">="
  value: 1

alert:
  destinations:
    - slack
    - email
  title_template: "Brute force login attempts detected from ${source_ip}"
  body_template: |
    Multiple failed login attempts detected indicating a potential brute force attack.

    Source IP: ${source_ip}
    Target User: ${user}
    Failed Attempts: ${attempt_count}
    First Attempt: ${first_attempt}
    Last Attempt: ${last_attempt}

    This behavior may indicate an automated credential guessing attack.

suppression:
  key: "${source_ip}-${user}"
  duration: 1h

tags:
  - authentication
  - brute-force
  - credential-access

references:
  - https://attack.mitre.org/techniques/T1110/
  - https://owasp.org/www-community/attacks/Brute_force_attack

mitre_attack:
  tactic: credential-access
  technique: T1110
  subtechnique: T1110.001
