# Malware Detection Response Plan

## Overview

This incident response plan outlines the procedures for responding to malware detection incidents on endpoints, including ransomware, trojans, rootkits, and other malicious software.

## Trigger Conditions

- Critical severity alerts from EDR systems
- Rule patterns matching: malware, ransomware, trojan, rootkit, suspicious_process
- Endpoint-tagged alerts

## Response Steps

### Step 1: Isolate the Host

**Priority: Immediate**
**Requires Approval: No (automated for critical threats)**

Immediately isolate the infected host from the network to prevent lateral movement and data exfiltration.

- Action: Network isolation
- Target: Affected host (by hostname or host ID)
- Method: EDR network containment
- Expected outcome: Host isolated, no network connectivity except to EDR console

### Step 2: Block Malicious IPs

**Priority: Immediate**

Block any known malicious IP addresses associated with the malware C2 infrastructure.

- Action: Block IP addresses
- Target: IPs from alert metadata (source_ip, destination_ip, c2_servers)
- Duration: 30 days
- Firewall: All perimeter firewalls

### Step 3: Terminate Malicious Processes

**Priority: High**

Kill any malicious processes identified by the EDR system.

- Action: Kill process
- Target: Process IDs from alert metadata
- Host: Affected endpoint
- Force: Yes

### Step 4: Collect Forensic Evidence

**Priority: High**

Trigger forensic data collection before any remediation that might destroy evidence.

- Action: Run query / Custom action
- Type: Forensic collection
- Collect: Memory dump, process list, network connections, file system timeline
- Store: Secure forensics bucket

### Step 5: Disable User Account

**Priority: Medium**
**Requires Approval: Yes (Security Manager)**

If the malware appears to have compromised user credentials or was introduced via phishing, disable the associated user account.

- Action: Disable account
- Target: User who was logged in on the affected host
- Reason: Potential credential compromise via malware

### Step 6: Create Incident Ticket

**Priority: High**

Create an incident ticket to track the investigation.

- Action: Create ticket
- System: Jira
- Project: SEC
- Type: Incident
- Priority: Critical
- Summary: Malware Detection - [hostname] - [malware_name]
- Description: Include all IOCs, affected systems, initial actions taken
- Labels: security-incident, malware, endpoint

### Step 7: Notify Security Team

**Priority: High**

Alert the security team and incident response team.

- Action: Send Slack notification
- Channel: #security-critical
- Include: Host details, malware type, IOCs, isolation status, ticket link
- Mention: @security-oncall

### Step 8: Escalate to IR Team

**Priority: High**

For critical malware incidents, escalate to the incident response team.

- Action: Send notification
- Method: PagerDuty
- Service: Incident Response Team
- Urgency: High

### Error Handling

If host isolation fails:
1. Notify security team immediately
2. Attempt secondary isolation method (firewall block)
3. If all methods fail, notify network operations for manual intervention

## Approval Requirements

- Account disable requires approval from: Security Manager
- Host unisolation requires approval from: Security Manager, IR Lead
- Approval timeout: 4 hours

## Post-Incident Steps

After the automated response:
1. Conduct full forensic analysis
2. Identify root cause and attack vector
3. Scan for lateral movement
4. Determine data impact
5. Remediate and restore host
6. Update detection rules based on findings

## Tags

- malware
- endpoint
- edr
- automated
- critical
