name: "Brute Force Login Attempts"
description: "Detects multiple failed login attempts from the same source IP address, which may indicate a brute force attack"
enabled: true
severity: "high"
category: "authentication"

query: |
  SELECT
    sourceipaddress,
    useridentity.principalid as user,
    COUNT(*) as failure_count,
    MIN(eventtime) as first_attempt,
    MAX(eventtime) as last_attempt,
    ARRAY_AGG(DISTINCT useragent) as user_agents
  FROM cloudtrail
  WHERE eventname = 'ConsoleLogin'
    AND errorcode IS NOT NULL
    AND errorcode IN ('Failed authentication', 'InvalidPassword')
    AND eventtime > CURRENT_TIMESTAMP - INTERVAL '15' MINUTE
  GROUP BY sourceipaddress, useridentity.principalid
  HAVING COUNT(*) >= 10

threshold:
  count: 1
  window: "15m"

metadata:
  mitre_attack:
    - "T1110"  # Brute Force
    - "T1110.001"  # Password Guessing
  tags:
    - "authentication"
    - "brute-force"
    - "cloudtrail"
  false_positives:
    - "Users legitimately forgetting passwords multiple times"
    - "Automated scripts with incorrect credentials"
    - "Password manager failures"
  response_actions:
    - "Investigate source IP address reputation"
    - "Check if targeted accounts have been compromised"
    - "Consider IP-based blocking or rate limiting"
    - "Review account lockout policies"
    - "Notify account owners of suspicious activity"
  references:
    - "https://attack.mitre.org/techniques/T1110/"
    - "https://docs.aws.amazon.com/IAM/latest/UserGuide/cloudtrail-integration.html"
