title: Google Workspace Brute Force Attack
id: itdr-gws-brute-force-001
status: stable
description: |
  Detects brute force attack targeting Google Workspace user accounts.
  Triggers when 5 or more failed login attempts occur for the same user
  within 15 minutes. Monitors for login_failure events in Google
  Workspace login audit logs.
author: Mantissa ITDR Team
date: 2025-01-28
modified: 2025-01-28

logsource:
  product: google_workspace
  service: login

detection:
  selection:
    id.applicationName: 'login'
    events.name:
      - 'login_failure'
      - 'login_challenge'
      - 'login_verification'
  filter_success:
    events.type: 'login'
    events.name: 'login_success'
  condition: selection and not filter_success | count(actor.email) by actor.email >= 5
  timeframe: 15m

fields:
  - actor.email
  - ipAddress
  - events.name
  - events.parameters.login_type
  - events.parameters.login_failure_type
  - events.parameters.login_challenge_method
  - '@timestamp'

falsepositives:
  - Users with forgotten passwords
  - SAML/OIDC federation issues
  - Mobile device sync problems

level: high

tags:
  - attack.credential_access
  - attack.t1110.001  # Brute Force: Password Guessing
  - attack.t1078.004  # Valid Accounts: Cloud Accounts
  - itdr
  - identity

references:
  - https://attack.mitre.org/techniques/T1110/001/
  - https://developers.google.com/admin-sdk/reports/v1/appendix/activity/login

custom:
  itdr_category: credential_attack
  itdr_subcategory: brute_force
  provider: google_workspace
  gws_failure_types:
    - login_failure
    - login_challenge_fail
    - suspicious_login_blocked
  recommended_action: |
    1. Review login failure reasons
    2. Check if 2-Step Verification is enabled
    3. Verify source IP reputation
    4. Consider enabling Google's Advanced Protection Program for high-risk users
