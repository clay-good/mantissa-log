title: Google Workspace Credential Stuffing Attack
id: itdr-gws-credential-stuffing-001
status: stable
description: |
  Detects credential stuffing attacks against Google Workspace.
  Triggers when 20+ unique users are attempted from the same IP within 10 minutes.
  Credential stuffing uses leaked credentials from breaches, often with
  automation showing consistent timing and user agent patterns.
author: Mantissa ITDR Team
date: 2025-01-28
modified: 2025-01-28

logsource:
  product: google_workspace
  service: login

detection:
  selection:
    id.applicationName: 'login'
    events.type: 'login'
  filter_internal:
    ipAddress:
      - '127.0.0.1'
      - '::1'
  condition: selection and not filter_internal | count(actor.email) by ipAddress >= 20
  timeframe: 10m

fields:
  - ipAddress
  - actor.email
  - events.name
  - events.type
  - events.parameters.login_type
  - events.parameters.login_failure_type
  - events.parameters.is_suspicious
  - events.parameters.login_challenge_method
  - '@timestamp'

falsepositives:
  - Google Cloud NAT gateways
  - Corporate proxy environments
  - Educational institutions
  - Shared workspace environments

level: critical

tags:
  - attack.credential_access
  - attack.t1110.004  # Brute Force: Credential Stuffing
  - attack.t1078.004  # Valid Accounts: Cloud Accounts
  - itdr
  - identity

references:
  - https://attack.mitre.org/techniques/T1110/004/
  - https://developers.google.com/admin-sdk/reports/v1/appendix/activity/login
  - https://support.google.com/a/answer/7587697

custom:
  itdr_category: credential_attack
  itdr_subcategory: credential_stuffing
  provider: google_workspace
  detection_thresholds:
    unique_user_threshold: 20
    time_window_minutes: 10
    success_threshold: 5
    failure_threshold: 10
  gws_login_events:
    login_success: "Successful login"
    login_failure: "Failed login"
    login_challenge: "Login challenge issued"
    suspicious_login: "Suspicious login detected"
    suspicious_login_blocked: "Suspicious login blocked"
  recommended_action: |
    1. Block the source IP at network perimeter
    2. Review successful logins from this IP
    3. Force password reset for affected accounts
    4. Enable Google's Advanced Protection Program for high-risk users
    5. Review Context-Aware Access policies
    6. Check for suspicious login alerts in Admin console
