title: Google Workspace Password Spray Attack
id: itdr-gws-password-spray-001
status: stable
description: |
  Detects password spray attacks against Google Workspace.
  Triggers when an IP targets 10+ unique users with fewer than 3 failures per user
  within 1 hour. Password spray attacks are low-and-slow to evade account lockouts.
author: Mantissa ITDR Team
date: 2025-01-28
modified: 2025-01-28

logsource:
  product: google_workspace
  service: login

detection:
  selection:
    id.applicationName: 'login'
    events.name: 'login_failure'
  condition: selection | count(actor.email) by ipAddress >= 10
  timeframe: 60m

fields:
  - ipAddress
  - actor.email
  - events.name
  - events.type
  - events.parameters.login_type
  - events.parameters.login_failure_type
  - events.parameters.is_suspicious
  - '@timestamp'

falsepositives:
  - SAML/OIDC federation issues
  - Password reset campaigns
  - Google Cloud service account testing
  - Security assessments

level: critical

tags:
  - attack.credential_access
  - attack.t1110.003  # Brute Force: Password Spraying
  - attack.t1078.004  # Valid Accounts: Cloud Accounts
  - itdr
  - identity

references:
  - https://attack.mitre.org/techniques/T1110/003/
  - https://developers.google.com/admin-sdk/reports/v1/appendix/activity/login
  - https://support.google.com/a/answer/6002699

custom:
  itdr_category: credential_attack
  itdr_subcategory: password_spray
  provider: google_workspace
  detection_thresholds:
    min_users_targeted: 10
    max_attempts_per_user: 3
    time_window_minutes: 60
  gws_failure_types:
    login_failure: "Failed password authentication"
    login_challenge_fail: "Failed login challenge"
    suspicious_login_blocked: "Google blocked suspicious login"
  recommended_action: |
    1. Block the source IP at network perimeter
    2. Review login audit logs for successful logins from this IP
    3. Force password reset for any compromised accounts
    4. Enable 2-Step Verification for all targeted users
    5. Review Context-Aware Access policies
    6. Consider Advanced Protection Program for high-risk users
