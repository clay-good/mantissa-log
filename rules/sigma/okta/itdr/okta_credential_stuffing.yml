title: Okta Credential Stuffing Attack
id: itdr-okta-credential-stuffing-001
status: stable
description: |
  Detects credential stuffing attacks against Okta.
  Triggers when 20+ unique users are attempted from the same IP within 10 minutes,
  OR when a mix of 5+ successes and 10+ failures occur from the same IP.
  Credential stuffing uses leaked credentials from breaches to attempt logins,
  often with automation tools showing consistent timing patterns.
author: Mantissa ITDR Team
date: 2025-01-28
modified: 2025-01-28

logsource:
  product: okta
  service: system

detection:
  selection_attempt:
    event.action:
      - 'user.session.start'
      - 'user.authentication.auth_via_mfa'
  selection_high_volume:
    # 20+ unique users from same IP
    condition: selection_attempt | count(user.email) by source.ip >= 20
  selection_mixed_results:
    # Mix of successes and failures indicating valid leaked credentials
    selection_success:
      event.outcome: 'success'
    selection_failure:
      event.outcome: 'failure'
  condition: selection_high_volume
  timeframe: 10m

fields:
  - source.ip
  - user.email
  - event.outcome
  - okta.outcome.reason
  - okta.client.userAgent.rawUserAgent
  - okta.client.device
  - okta.client.zone
  - source.geo.country_name
  - source.geo.city_name
  - '@timestamp'

falsepositives:
  - Shared NAT/proxy environments with many legitimate users
  - Corporate VPN exit points
  - University networks
  - Large enterprise SSO deployments

level: critical

tags:
  - attack.credential_access
  - attack.t1110.004  # Brute Force: Credential Stuffing
  - attack.t1078      # Valid Accounts
  - itdr
  - identity

references:
  - https://attack.mitre.org/techniques/T1110/004/
  - https://developer.okta.com/docs/reference/api/system-log/
  - https://owasp.org/www-community/attacks/Credential_stuffing

custom:
  itdr_category: credential_attack
  itdr_subcategory: credential_stuffing
  provider: okta
  detection_thresholds:
    unique_user_threshold: 20
    time_window_minutes: 10
    success_threshold: 5
    failure_threshold: 10
  automation_indicators:
    - Consistent user agent across attempts
    - Regular timing intervals between requests
    - Known bot/automation tool signatures
  recommended_action: |
    1. Block the source IP immediately at firewall/WAF
    2. Review all successful logins from this IP for compromise
    3. Force password reset for users with successful authentications
    4. Check if source IP appears in threat intelligence feeds
    5. Analyze timing patterns for automation signatures
    6. Review user agents for known attack tool signatures
