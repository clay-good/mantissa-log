title: Azure AD Brute Force Attack - Single User
id: itdr-azure-brute-force-single-user-001
status: stable
description: |
  Detects brute force attack targeting a single Azure AD user account.
  Triggers when 5 or more failed login attempts occur for the same user
  within 15 minutes. Monitors for error codes 50126 (invalid password)
  and 50053 (account locked).
author: Mantissa ITDR Team
date: 2025-01-28
modified: 2025-01-28

logsource:
  product: azure
  service: signinlogs

detection:
  selection:
    properties.status.errorCode:
      - 50126  # Invalid username or password
      - 50053  # Account is locked
      - 50055  # Password expired
      - 50057  # User account disabled
      - 50076  # MFA required but not completed
  condition: selection | count(properties.userPrincipalName) by properties.userPrincipalName >= 5
  timeframe: 15m

fields:
  - properties.userPrincipalName
  - properties.ipAddress
  - properties.location.countryOrRegion
  - properties.location.city
  - properties.status.errorCode
  - properties.status.failureReason
  - properties.deviceDetail.browser
  - properties.deviceDetail.operatingSystem
  - '@timestamp'

falsepositives:
  - Users with forgotten passwords
  - Password manager issues
  - Legacy applications with cached credentials

level: high

tags:
  - attack.credential_access
  - attack.t1110.001  # Brute Force: Password Guessing
  - attack.t1078.004  # Valid Accounts: Cloud Accounts
  - itdr
  - identity

references:
  - https://attack.mitre.org/techniques/T1110/001/
  - https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/reference-sign-ins-error-codes

custom:
  itdr_category: credential_attack
  itdr_subcategory: brute_force
  provider: azure
  azure_error_codes:
    50126: "Invalid username or password"
    50053: "Account is locked"
    50055: "Password expired"
    50057: "User account disabled"
  recommended_action: |
    1. Check if account lockout policy triggered
    2. Review source IP locations for anomalies
    3. Verify if this is a legitimate user
    4. Consider implementing smart lockout policies
