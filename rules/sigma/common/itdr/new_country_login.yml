title: Login from New Country
id: itdr-common-new-country-001
status: stable
description: |
  Detects authentication from a country not previously seen in the user's
  behavioral baseline. First-time country access is a significant indicator
  of potential credential theft, especially when combined with other anomalies.

  Analysis is performed by the NewAccessDetector which compares the event's
  source country against the user's baseline known_countries set.
author: Mantissa ITDR Team
date: 2025-01-28
modified: 2025-01-28

logsource:
  category: authentication
  # Applies to all identity providers

detection:
  selection:
    event_type: 'AUTH_SUCCESS'
  filter_has_geo:
    source_geo.country|exists: true
  condition: selection and filter_has_geo

fields:
  - user_email
  - source_ip
  - source_geo.country
  - source_geo.city
  - source_geo.latitude
  - source_geo.longitude
  - device_fingerprint
  - user_agent
  - provider
  - '@timestamp'

falsepositives:
  - Business travel to new countries
  - Remote workers relocating
  - VPN exit nodes in different countries
  - Mobile users traveling internationally
  - New employee's first login from their location

level: high

tags:
  - attack.initial_access
  - attack.credential_access
  - attack.t1078      # Valid Accounts
  - attack.t1078.004  # Valid Accounts: Cloud Accounts
  - itdr
  - identity
  - behavioral

references:
  - https://attack.mitre.org/techniques/T1078/004/
  - https://www.cisa.gov/news-events/cybersecurity-advisories

custom:
  itdr_category: behavioral_anomaly
  itdr_subcategory: new_location
  provider: common
  detection_type: post_processing
  location_novelty_scores:
    new_country: 1.0
    new_city_known_country: 0.5
    new_ip_known_city: 0.2
  severity_escalation:
    new_country_only: high
    new_country_plus_new_device: critical
    new_country_plus_unusual_time: critical
  recommended_action: |
    1. Verify with user through out-of-band communication
    2. Check if user has legitimate travel plans
    3. Review for VPN usage that might explain the location
    4. Examine session activity for suspicious behavior
    5. Consider requiring step-up authentication
    6. If suspicious, revoke session and force re-authentication
