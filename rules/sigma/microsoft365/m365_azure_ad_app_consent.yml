title: Microsoft 365 Suspicious Azure AD App Consent
id: d4e5f6a7-b8c9-0123-4567-890123defghi
status: stable
description: Detects user consent to Azure AD applications which could be used for persistence or data access
author: Mantissa Security Team
date: 2025-01-28
modified: 2025-01-28

logsource:
  product: microsoft365
  service: azureactivedirectory

detection:
  selection:
    event.action:
      - 'Consent to application'
      - 'Add app role assignment grant to user'
      - 'Add delegated permission grant'
  filter_high_risk_permissions:
    microsoft365.modified_properties:
      - Name: 'ConsentAction.Permissions'
        NewValue|contains:
          - 'Mail.Read'
          - 'Mail.ReadWrite'
          - 'Files.Read.All'
          - 'Files.ReadWrite.All'
          - 'User.Read.All'
          - 'Directory.Read.All'
  condition: selection and filter_high_risk_permissions

fields:
  - user.email
  - user.name
  - '@timestamp'
  - source.ip
  - microsoft365.operation
  - microsoft365.application_id
  - microsoft365.modified_properties

falsepositives:
  - IT-approved productivity applications
  - Microsoft first-party applications
  - Approved enterprise integrations

level: high

tags:
  - attack.persistence
  - attack.collection
  - attack.t1528  # Steal Application Access Token
  - attack.t1114  # Email Collection
