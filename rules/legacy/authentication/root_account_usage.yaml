name: "Root Account Usage Detected"
description: "Detects any activity performed using the AWS root account, which should only be used in emergency situations"
enabled: true
severity: "critical"
category: "authentication"

query: |
  SELECT
    eventname,
    eventsource,
    sourceipaddress,
    eventtime,
    useragent,
    requestparameters,
    responseelements,
    'Root account activity detected' as reason
  FROM cloudtrail
  WHERE useridentity.type = 'Root'
    AND eventtime > CURRENT_TIMESTAMP - INTERVAL '1' HOUR
    AND eventname NOT IN (
      'GetAccountPasswordPolicy',
      'ListAccountAliases'
    )

threshold:
  count: 1
  window: "1h"

metadata:
  mitre_attack:
    - "T1078"
    - "T1078.004"
    - "T1531"
  tags:
    - "authentication"
    - "root-account"
    - "cloudtrail"
    - "critical-security"
  false_positives:
    - "Emergency account recovery operations"
    - "Initial AWS account setup"
    - "Automated health checks (filtered out in query)"
  response_actions:
    - "IMMEDIATE: Verify if this is legitimate emergency access"
    - "Contact all account owners immediately"
    - "Review all actions performed by root account"
    - "If unauthorized, rotate all credentials immediately"
    - "Enable CloudTrail alerts for root account if not already enabled"
    - "Verify MFA is enabled on root account"
    - "Check for creation of new IAM users or access keys"
    - "Review billing for unauthorized resources"
  references:
    - "https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#lock-away-credentials"
    - "https://attack.mitre.org/techniques/T1078/"
  notes:
    - "AWS best practices recommend never using root account for day-to-day operations"
    - "Root account should have MFA enabled and credentials locked away"
    - "Consider setting up AWS Organizations to centralize root account management"
